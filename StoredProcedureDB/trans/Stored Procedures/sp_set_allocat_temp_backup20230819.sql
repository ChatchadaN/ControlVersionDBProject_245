-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [trans].[sp_set_allocat_temp_backup20230819]
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	-------------------------------------------------------------------------------------------------------
	-- (1) fix information delete se Tomson3
	-------------------------------------------------------------------------------------------------------
	UPDATE [APCSProDB].[method].[allocat] 
	SET [Tomson3] = '    '
	WHERE LotNo IN (
		--'2303A2714V',
		--'2303A2715V',
		--'2303A2717V',
		--'2303G2716V',
		--'2304A2621V',
		'2304A4416V',
		'2304A5639V',
		--'2305A7641V',
		--'2305A7643V',
		'2306A5625V',
		--'2307A1692V',
		--'2307A2627V',
		'2307A2629V',
		--'2307A3537V',
		--'2307A3538V',
		'2307A3539V',
		--'2307A4703V',
		--'2307A4704V',
		--'2307A4705V',
		'2307A4706V',
		--'2307A5649V',
		--'2307A5650V',
		--'2307A5651V',
		--'2307A5652V',
		'2307A5653V',
		--'2307A6675V',
		--'2307A6676V',
		--'2307A6677V',
		--'2307A6678V',
		'2307A6679V',
		'2307A6680V',
		--'2307A7650V',
		--'2307A7651V',
		'2307A7652V',
		'2307A7653V',
		'2307A7654V',
		--'2307D2944V',
		--'2307G4703V',
		--'2307G4704V',
		--'2307G4705V',
		--'2307G4706V',
		--'2307G5649V',
		--'2307G5650V',
		--'2307G5651V',
		--'2307G5652V',
		--'2307G5653V',
		--'2307G7651V',
		--'2307G7652V',
		--'2307G7654V',
		--'2308A1703V',
		--'2308A1704V',
		--'2308A1705V',
		--'2308A1706V',
		--'2308A1707V',
		'2308A1708V',
		'2308A2690V',
		--'2308A2691V',
		'2308A2692V',
		--'2308A2693V',
		--'2308A2694V',
		'2308A2695V',
		--'2308A3584V',
		'2308A3585V',
		--'2308A3586V',
		--'2308A3587V',
		--'2308A3588V',
		'2308A3589V',
		--'2308A4595V',
		--'2308A4596V',
		'2308A4597V',
		--'2308A4598V',
		'2308A4599V',
		'2308A4600V',
		'2308A5597V',
		'2308A5598V',
		'2308A5599V',
		'2308A5600V',
		'2308A5601V',
		--'2308A5602V',
		'2308A5603V',
		--'2308A6633V',
		--'2308A6634V',
		--'2308A6635V',
		'2308A6636V',
		--'2308A6637V',
		'2308A6638V',
		--'2308A7537V',
		--'2308A7538V',
		--'2308A7539V',
		'2308A7540V',
		--'2308A7541V',
		'2308A7542V',
		--'2308D3887V',
		--'2308D4880V',
		--'2308D4916V',
		--'2308D6595V',
		--'2308D6596V',
		--'2308D6597V',
		--'2308D6598V',
		--'2308D6599V',
		--'2308D6600V',
		--'2308D6602V',
		--'2308D6603V',
		--'2308D6607V',
		--'2308D6608V',
		--'2308D7319V',
		--'2308D7320V',
		--'2308G4595V',
		--'2308G4596V',
		--'2308G4597V',
		--'2308G4598V',
		--'2308G4600V',
		--'2308G5597V',
		--'2308G5598V',
		--'2308G5599V',
		'2308G7537V',
		'2308G7538V',
		'2308G7539V',
		'2308G7540V',
		'2308G7541V',
		'2308G7542V',
		--'2309A1576V',
		--'2309A1577V',
		'2309A1578V',
		--'2309A1579V',
		'2309A1580V',
		'2309A1581V',
		'2309G1576V',
		'2309G1577V',
		'2309G1578V',
		'2309G1579V',
		'2309G1580V',
		'2309G1581V'
		--'2303G2714V',
		--'2303G2715V',
		--'2303G2717V'      
	);
	-------------------------------------------------------------------------------------------------------
	-- (1) fix information add se Tomson3
	-------------------------------------------------------------------------------------------------------
	UPDATE [APCSProDB].[method].[allocat] 
	SET [Tomson3] = IIF([Tomson3] LIKE '%SE%',[Tomson3],' SE ')
	WHERE [LotNo] IN (
		--'2309A5459V',          
		'2309A5461V'          
		--'2311F6003V',          
		--'2311D7481V',          
		--'2311D7483V',          
		--'2311D7484V',          
		--'2311D7486V',          
		--'2311D7487V',          
		--'2311D7488V',          
		--'2311D7489V',          
		--'2311D7490V',          
		--'2312A4551V',          
		--'2312A4552V',          
		--'2312A4553V',          
		--'2312A4554V',          
		--'2312A4555V',          
		--'2312A4562V',          
		--'2312A4563V',          
		--'2312A4564V',          
		--'2312A4565V',          
		--'2312A4566V',          
		--'2312A4567V',          
		--'2312A4568V',          
		--'2312A5544V',          
		--'2312A5545V',          
		--'2312A5546V',          
		--'2312A5547V',          
		--'2312A5548V',          
		--'2312A6543V',          
		--'2312A6544V',          
		--'2312A6545V',          
		--'2312A6546V',          
		--'2312A6547V',          
		--'2312A6548V',          
		--'2312A6549V',          
		--'2312A6550V',          
		--'2312A6551V',          
		--'2312A6552V',          
		--'2312A6553V',          
		--'2312A6554V',          
		--'2312A6555V',          
		--'2312A6556V'         
	);
	-------------------------------------------------------------------------------------------------------
	-- (1) fix information add clear se Tomson3
	-------------------------------------------------------------------------------------------------------
	UPDATE [APCSProDB].[method].[allocat]
	SET [Tomson3] = '    '
	WHERE [LotNo] IN (
		'2312F4002V',
		'2312F4007V',
		'2312F6004V',
		'2313F4001V',
		'2313F4002V',
		'2313F4003V',
		'2313F4004V',
		'2323F5001V',
		--'2312F6002V',
		--'2317F5002V',
		'2317F5001V',
		'2321F4002V',
		--'2321F4001V',
		--'2322F4003V',
		'2322F4004V',
		--'2322F4005V',
		--'2322F4006V',
		--'2322F4007V',
		--'2322F4008V',
		--'2322F4009V',
		--'2322F4010V',
		--'2322F4011V',
		'2322F4012V',
		'2322F4013V',
		--'2322F4014V',
		--'2322F4015V',
		--'2322F4016V',
		'2322F4017V',
		'2322F4018V',
		'2322F4019V',
		'2322F4026V',
		'2322F4028V',
		'2322F4027V',
		'2322F4025V',
		--'2324F5001V',
		--'2324F5002V',
		--'2324F5003V',
		--'2324F5004V',
		--'2324F5005V',
		--'2324F5006V',
		--'2324F5007V',
		--'2324F5008V',
		--'2324F5009V',
		--'2324F5010V',
		--'2324F5011V',
		'2324F5012V',
		'2324F5013V',
		--'2324F5014V',
		'2324F5015V',
		--'2324F5016V',
		'2324F5017V',
		--'2324F5018V',
		'2324F5019V',
		--'2324F5020V',
		--'2324F5021V',
		'2324F5022V',
		--'2324F5023V',
		--'2324F5024V',
		--'2324F5025V',
		'2324F5026V',
		--'2324F5027V',
		--'2324F5028V',
		--'2324F5029V',
		--'2324F5030V',
		--'2324F5031V',
		--'2324F5032V',
		--'2324F5033V',
		--'2324F5034V',
		--'2324F5035V',
		'2324F5036V',
		'2326F6002V',
		'2312F4003V',
		--'2312F4008V',
		'2312F6003V',
		'2313F4005V',
		--'2313F4006V',
		'2313F4008V',
		--'2313F4010V',
		'2313F4007V',
		--'2313F4009V',
		'2320F6022V',
		--'2320F6023V',
		'2320F6024V',
		--'2320F6025V',
		--'2320F6026V',
		--'2320F6027V',
		--'2320F6028V',
		--'2320F6029V',
		'2320F6030V',
		'2322F2001V',
		--'2322F2002V',
		'2322F2003V',
		'2322F2004V',
		'2322F2005V',
		--'2322F2006V',
		'2322F4020V',
		--'2322F4021V',
		'2322F4022V',
		--'2322F4024V'
		'2322F4023V',

		'2329F4002V', --new lot 2023/08/01
		'2329F4006V',
		'2329F4001V'
		,'2329F4003V'
		,'2329F4004V'
		,'2329F4005V'
		,'2329F4007V'
		,'2329F4008V'
		,'2329F4009V'
		,'2329F4010V'
		,'2331F2001V'
		,'2331F2002V'
		,'2331F2003V'
		,'2331F2004V'
		,'2331F2005V'
		,'2331F2006V'
		,'2331F2007V'
		,'2331F2008V'
		,'2331F2009V'
		,'2331F2010V'
		,'2331F2011V'
		,'2331F2012V'
		,'2331F2013V'
		,'2331F2014V'
		,'2331F2015V'
		,'2331F2016V'
		,'2331F2017V'
		,'2331F2018V'
		,'2331F2019V'
		,'2331F2020V'
		,'2331F2021V'
		,'2331F2022V'
		,'2331F2023V'
		,'2331F2024V'
		,'2331F2025V'
		,'2331F2026V'
		,'2331F2027V'
		,'2331F2028V'
		,'2331F2029V'
		,'2331F2030V'
		,'2331F2031V'
		,'2331F2032V'
		,'2331F2033V'
		,'2331F2034V'
		,'2331F2035V'
		,'2331F2036V'
		,'2331F2037V'
		,'2331F2038V'
		,'2331F2039V'
		,'2331F2040V'
		,'2331F2041V'
		,'2331F2042V'
		,'2331F2043V'
		,'2331F2044V'
		,'2331F2045V'
		,'2331F2046V'
		,'2331F2047V'
		,'2331F2048V'
		,'2331F2049V'
		,'2331F2050V'
		,'2331F2051V'
		,'2331F2052V'
		,'2331F2053V'
		,'2331F2054V'
		,'2331F2055V'
		,'2331F2056V'
		,'2331F2057V'
		,'2331F2058V'
		,'2331F2059V'
		,'2331F2060V'
		,'2331F2061V'
		,'2331F2062V'
		,'2331F2063V'
		,'2331F2064V'
		,'2331F2065V'
		,'2331F2066V'
		,'2331F2067V'
		,'2331F2068V'
		,'2331F2069V'
		,'2331F2070V'
		,'2331F2071V'
		,'2331F2072V'
		,'2331F2073V'
		,'2331F2074V'
		,'2331F2075V'
		,'2331F2076V'
		,'2331F2077V'
		,'2331F2078V'
		,'2331F2079V'
		,'2331F2080V'
		,'2331F2081V'
		,'2331F2083V'
		,'2331F2084V'
		,'2331F2085V'
		,'2331F2086V'
		,'2331F2087V'
		,'2331F2088V'
		,'2331F2089V'
		,'2331F2090V'
		,'2331F2091V'
		,'2331F2092V'
		,'2331F2093V'
		,'2331F2094V'
		,'2331F2095V'
		,'2331F2096V'
	);

	--UPDATE [APCSProDB].[method].[allocat]
	--SET [Packing_Standerd_QTY] = 2500
	--WHERE [LotNo] = '2328A1517V';

	--UPDATE [APCSProDB].[method].[allocat_temp]
	--SET [Packing_Standerd_QTY] = 2500
	--WHERE [LotNo] = '2328A1517V';
	-------------------------------------------------------------------------------------------------------
	-- (2) insert or update allocat to allocat_temp
	-------------------------------------------------------------------------------------------------------
    -- Insert statements for procedure here
	MERGE [APCSProDB].[method].[allocat_temp] AS allocat_temp
	USING [APCSProDB].[method].[allocat] AS allocat ON (allocat_temp.LotNo = allocat.LotNo) 
	WHEN MATCHED AND allocat_temp.Tomson3 != allocat.Tomson3
		THEN UPDATE SET allocat_temp.Tomson3 = allocat.Tomson3
	WHEN NOT MATCHED BY TARGET 
		THEN INSERT ([LotNo]
			  ,[Type_Name]
			  ,[ROHM_Model_Name]
			  ,[ASSY_Model_Name]
			  ,[R_Fukuoka_Model_Name]
			  ,[TIRank]
			  ,[Rank]
			  ,[TPRank]
			  ,[SUBRank]
			  ,[PDCD]
			  ,[Mask]
			  ,[KNo]
			  ,[MNo]
			  ,[ORNo]
			  ,[Packing_Standerd_QTY]
			  ,[Tomson1]
			  ,[Tomson2]
			  ,[Tomson3]
			  ,[WFLotNo]
			  ,[LotNo_Class]
			  ,[User_Code]
			  ,[Product_Control_Cl_1]
			  ,[Product_Class]
			  ,[Production_Class]
			  ,[Rank_No]
			  ,[HINSYU_Class]
			  ,[Label_Class]
			  ,[OUT_OUT_FLAG]
			  ,[allocation_Date]
			  ,[allocation_QTY]
			  ,[Print_Flag]
			  ,[Timestamp_Date]
			  ,[Timestamp_Time]) 
		VALUES (allocat.[LotNo]
			  ,allocat.[Type_Name]
			  ,allocat.[ROHM_Model_Name]
			  ,allocat.[ASSY_Model_Name]
			  ,allocat.[R_Fukuoka_Model_Name]
			  ,allocat.[TIRank]
			  ,allocat.[Rank]
			  ,allocat.[TPRank]
			  ,allocat.[SUBRank]
			  ,allocat.[PDCD]
			  ,allocat.[Mask]
			  ,allocat.[KNo]
			  ,allocat.[MNo]
			  ,allocat.[ORNo]
			  ,allocat.[Packing_Standerd_QTY]
			  ,allocat.[Tomson1]
			  ,allocat.[Tomson2]
			  ,allocat.[Tomson3]
			  ,allocat.[WFLotNo]
			  ,allocat.[LotNo_Class]
			  ,allocat.[User_Code]
			  ,allocat.[Product_Control_Cl_1]
			  ,allocat.[Product_Class]
			  ,allocat.[Production_Class]
			  ,allocat.[Rank_No]
			  ,allocat.[HINSYU_Class]
			  ,allocat.[Label_Class]
			  ,allocat.[OUT_OUT_FLAG]
			  ,allocat.[allocation_Date]
			  ,allocat.[allocation_QTY]
			  ,allocat.[Print_Flag]
			  ,allocat.[Timestamp_Date]
			  ,allocat.[Timestamp_Time]);
END
